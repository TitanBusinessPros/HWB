<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Halloween Website Builder — Export to HTML</title>
<!-- Google Fonts for spooky vibe -->
<link href="https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=MedievalSharp&family=Uncial+Antiqua&family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
  :root{
    --panel-bg:#111;
    --panel-fg:#eee;
    --accent:#b30000;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background:linear-gradient(180deg,#050005 0%, #1a0d12 100%);
    color:var(--panel-fg);
    min-height:100vh;
    display:flex;
    gap:12px;
    padding:12px;
  }

  /* Left control panel */
  .sidebar{
    width:360px;
    max-width:40%;
    background:rgba(0,0,0,0.65);
    border-radius:12px;
    padding:16px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    overflow:auto;
    border:1px solid rgba(255,255,255,0.03);
  }
  .sidebar h2{margin:4px 0 12px 0;font-size:18px}
  label{display:block;margin-top:8px;font-size:13px;color:#ddd}
  input[type="text"], input[type="url"], textarea, select {
    width:100%;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.06);
    background:rgba(255,255,255,0.02);
    color:var(--panel-fg);
    margin-top:6px;
  }
  textarea{min-height:70px}
  .row{display:flex;gap:8px}
  .btn{
    display:inline-block;
    padding:8px 12px;
    background:var(--accent);
    border-radius:8px;
    color:white;
    font-weight:600;
    cursor:pointer;
    border:0;
    margin-top:8px;
  }
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.08);color:#fff}
  .small{padding:6px 8px;font-size:13px}
  .section-list{margin-top:12px}
  .section-card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.2));
    border-radius:10px;
    padding:8px;
    margin-bottom:8px;
    border:1px solid rgba(255,255,255,0.03);
  }
  .section-actions{display:flex;gap:8px;margin-top:8px}
  .muted{opacity:0.75;font-size:13px}

  /* preview */
  .preview-wrap{
    flex:1;
    min-width:360px;
    background:linear-gradient(180deg,#0c0a12 0%, #20101a 100%);
    border-radius:12px;
    padding:10px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .preview-toolbar{
    display:flex;
    gap:8px;
    align-items:center;
    justify-content:space-between;
  }
  .preview{
    flex:1;
    background:linear-gradient(180deg,#08070a, #150811);
    border-radius:10px;
    padding:24px;
    overflow:auto;
    border:1px solid rgba(255,255,255,0.03);
  }

  .site{
    max-width:1100px;
    margin:0 auto;
    border-radius:8px;
    overflow:hidden;
    background:linear-gradient(180deg,#0a0410,#15061a);
    box-shadow: 0 10px 40px rgba(0,0,0,0.7);
  }

  footer.builder-footer{
    padding:18px;
    font-size:14px;
    background:linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.6));
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }

  /* helper UI */
  .control-row{display:flex;gap:8px;align-items:center}
  .muted-small{font-size:12px;color:#bbb}

  /* preview default styles for exported page components (editor-only) */
  .page-header{padding:40px 24px;text-align:center}
  .page-paragraph{padding:18px 24px;max-width:900px;margin:0 auto}
  .image-block{display:block;margin:12px auto;border-radius:8px;max-width:100%}
  .gallery-grid{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
  .gallery-grid img{width:calc(33% - 8px);min-width:160px;border-radius:8px}
  .monster-list{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;padding:12px}
  .monster-card{width:200px;border-radius:10px;padding:12px;background:rgba(255,255,255,0.02);text-align:center}
  .monster-card img{width:100%;border-radius:8px;margin-bottom:8px}

  /* small responsive */
  @media(max-width:900px){
    body{flex-direction:column;padding:8px}
    .sidebar{width:100%;max-width:none}
    .preview-wrap{width:100%}
  }

  /* tiny footer hint */
  .hint{font-size:12px;color:#bbb;margin-top:8px}
</style>
</head>
<body>
  <div class="sidebar" id="controls">
    <h2>Halloween Website Builder</h2>
    <div class="muted">Create a spooky landing page for parties & haunted houses. Export to a full HTML file.</div>

    <label>Site Title</label>
    <input type="text" id="siteTitle" placeholder="Name of haunt or party" value="The Nightfall Manor" />

    <label>Global Background (image URL) <span class="muted-small">optional</span></label>
    <input type="url" id="globalBg" placeholder="https://example.com/bg.jpg" />

    <label>Global Accent Color</label>
    <input type="color" id="globalAccent" value="#b30000" />

    <label>Default Font</label>
    <select id="defaultFont">
      <option value="Creepster, cursive">Creepster — spooky sign</option>
      <option value="Nosifer, cursive">Nosifer — dripping</option>
      <option value="MedievalSharp, cursive">MedievalSharp — gothic</option>
      <option value="Uncial Antiqua, serif">Uncial Antiqua — ancient</option>
      <option value="'Press Start 2P', monospace">Press Start 2P — arcade</option>
      <option value="Arial, sans-serif">System — fallback</option>
    </select>

    <div style="display:flex;gap:8px;margin-top:8px;">
      <button class="btn" id="addHeader">+ Header & Paragraph</button>
      <button class="btn" id="addImage">+ Image</button>
    </div>
    <div style="display:flex;gap:8px;margin-top:8px;">
      <button class="btn ghost" id="addGallery">+ Gallery</button>
      <button class="btn ghost" id="addMonsters">+ Monster List</button>
    </div>

    <div class="section-list" id="sectionsContainer">
      <!-- dynamic -->
    </div>

    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.04);margin:12px 0" />

    <h3 style="margin:4px 0">Contact / Footer</h3>
    <label>Contact Title</label>
    <input type="text" id="contactTitle" placeholder="Contact & Booking" value="Contact & Booking" />
    <label>Email</label>
    <input type="text" id="contactEmail" placeholder="booking@nightfall.com" value="booking@nightfall.com" />
    <label>Phone</label>
    <input type="text" id="contactPhone" placeholder="(555) 666-1313" value="(555) 666-1313" />
    <label>Address / Short note</label>
    <input type="text" id="contactAddr" placeholder="123 Gravestone Rd, Spooksville" value="123 Gravestone Rd, Spooksville" />

    <div style="display:flex;gap:8px;margin-top:10px">
      <button class="btn" id="exportBtn">Export HTML</button>
      <button class="btn ghost" id="previewReset">Reset Demo</button>
    </div>

    <div class="hint">Tip: click a section in the list to edit its settings. Reorder with ↑ ↓. Use image URLs (hotlink-ready) for decorations.</div>
  </div>

  <div class="preview-wrap">
    <div class="preview-toolbar">
      <div>
        <strong id="previewTitle">Live Preview</strong>
        <span class="muted" id="previewSubtitle"> — edits update instantly</span>
      </div>
      <div class="control-row">
        <button class="btn small" id="downloadPreview">Download Preview HTML</button>
        <button class="btn small ghost" id="darkPreviewToggle">Toggle Dark Accent</button>
      </div>
    </div>

    <div class="preview" id="previewArea">
      <!-- rendered preview -->
    </div>
  </div>

<script>
/*
  Halloween Website Builder (all client-side)
  - sections: array of objects: {type, props}
  - types: header, image, gallery, monsters
*/
const sections = [];

// default demo content
const demoSections = [
  { id: uid(), type:'header', props:{
      title:'THE NIGHTFALL MANOR',
      subtitle:'A haunted house & Halloween party experience',
      titleFont:"Creepster, cursive",
      titleColor:"#ffd9d9",
      bgColor:"#22030a",
      textColor:"#f6e9e9",
      bgImage:"",
  }},
  { id: uid(), type:'paragraph', props:{
      text:'Come for the screams, stay for the nightmares. Open weekends in October — costumed staff, live actors, fog machines, and an immersive maze of horrors.',
      font:"Uncial Antiqua, serif",
      textColor:"#f6e9e9",
      bgColor:"transparent",
      align:"center"
  }},
  { id: uid(), type:'gallery', props:{
      images:[
        'https://images.unsplash.com/photo-1508057198894-247b23fe5ade?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=6b53a5a1c3c4f6c84cf7b9fa7d8f0b0a',
        'https://images.unsplash.com/photo-1544705482-1a8b134b9d5b?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=9c7f9f0d0a8e8b2b5fbb2b7b8d0c3f61',
        'https://images.unsplash.com/photo-1501594907352-04cda38ebc29?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=2bd6f2c8d3b9c5d9f8d93b6f8d4a9a9d'
      ],
      itemFont:"Press Start 2P, monospace",
      bgColor:"transparent",
      gap:8
  }},
  { id: uid(), type:'monsters', props:{
      items:[
        {name:'Gravekeeper Gertie', img:'https://images.unsplash.com/photo-1543779502-9b2a8f6ca3a8?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=2b4b24b2f7c6d4c1a2'},
        {name:'The Ragged Gentleman', img:'https://images.unsplash.com/photo-1526481280698-5a3e9e4f8a0e?q=80&w=800&auto=format&fit=crop&ixlib=rb-4.0.3&s=3d2b2c1a7f9b8c6d5e4f3a2b1c'}
      ],
      cardBg:"rgba(255,255,255,0.02)"
  }}
];

const previewArea = document.getElementById('previewArea');
const sectionsContainer = document.getElementById('sectionsContainer');

function uid(){ return 'id-' + Math.random().toString(36).slice(2,9); }

function resetDemo(){
  sections.length = 0;
  demoSections.forEach(s => sections.push(JSON.parse(JSON.stringify(s))));
  renderSectionsList();
  renderPreview();
}

document.getElementById('previewReset').addEventListener('click', ()=> {
  if(!confirm('Reset demo content? Your unsaved changes will be lost.')) return;
  resetDemo();
});

document.getElementById('addHeader').addEventListener('click', ()=> {
  const s = { id: uid(), type:'header', props:{
    title:'Scare Night',
    subtitle:'Enter if you dare...',
    titleFont:document.getElementById('defaultFont').value,
    titleColor:'#ffeded',
    bgColor:'#2a0710',
    textColor:'#f7eaea',
    bgImage:''
  }};
  sections.push(s);
  renderSectionsList();
  renderPreview();
  openEditor(s.id);
});

document.getElementById('addImage').addEventListener('click', ()=> {
  const s = { id: uid(), type:'image', props:{
    url:'https://images.unsplash.com/photo-1508898578281-774ac4893a28?q=80&w=1000&auto=format&fit=crop&ixlib=rb-4.0.3&s=8a1e4899a2b2c1d9e7f9a8b7c6d',
    caption:'Dark woods',
    width:'100%',
    bgColor:'transparent'
  }};
  sections.push(s);
  renderSectionsList();
  renderPreview();
  openEditor(s.id);
});

document.getElementById('addGallery').addEventListener('click', ()=> {
  const s = { id: uid(), type:'gallery', props:{ images:[], itemFont:document.getElementById('defaultFont').value, bgColor:'transparent', gap:8 } };
  sections.push(s);
  renderSectionsList();
  renderPreview();
  openEditor(s.id);
});

document.getElementById('addMonsters').addEventListener('click', ()=> {
  const s = { id: uid(), type:'monsters', props:{ items:[], cardBg:'rgba(255,255,255,0.02)' } };
  sections.push(s);
  renderSectionsList();
  renderPreview();
  openEditor(s.id);
});

document.getElementById('exportBtn').addEventListener('click', ()=> {
  const html = buildExportHtml();
  downloadFile(html, 'haunted-site.html', 'text/html');
});

document.getElementById('downloadPreview').addEventListener('click', ()=> {
  const html = buildExportHtml(true); // preview mode
  downloadFile(html, 'preview-haunted.html', 'text/html');
});

document.getElementById('globalAccent').addEventListener('input', e=>{
  document.documentElement.style.setProperty('--accent', e.target.value);
});

// render section list (controls)
function renderSectionsList(){
  sectionsContainer.innerHTML = '';
  sections.forEach((s, idx) => {
    const card = document.createElement('div');
    card.className = 'section-card';
    const title = document.createElement('div');
    title.innerHTML = `<strong>${idx+1}. ${typeLabel(s.type)}</strong> <span class="muted-small">(${s.id})</span>`;
    card.appendChild(title);

    const brief = document.createElement('div');
    brief.className = 'muted';
    brief.textContent = shortSummary(s);
    card.appendChild(brief);

    const actions = document.createElement('div');
    actions.className = 'section-actions';
    const editBtn = document.createElement('button');
    editBtn.className='btn small ghost';
    editBtn.textContent='Edit';
    editBtn.onclick = ()=> openEditor(s.id);

    const upBtn = document.createElement('button'); upBtn.className='btn small ghost'; upBtn.textContent='↑'; upBtn.onclick = ()=> moveSection(idx, -1);
    const downBtn = document.createElement('button'); downBtn.className='btn small ghost'; downBtn.textContent='↓'; downBtn.onclick = ()=> moveSection(idx, +1);
    const delBtn = document.createElement('button'); delBtn.className='btn small'; delBtn.textContent='Delete'; delBtn.onclick = ()=> {
      if(confirm('Delete this section?')){ sections.splice(idx,1); renderSectionsList(); renderPreview(); }
    };
    actions.appendChild(editBtn);
    actions.appendChild(upBtn);
    actions.appendChild(downBtn);
    actions.appendChild(delBtn);
    card.appendChild(actions);

    sectionsContainer.appendChild(card);
  });
}

function typeLabel(t){
  if(t==='header') return 'Header';
  if(t==='paragraph') return 'Paragraph';
  if(t==='image') return 'Image';
  if(t==='gallery') return 'Gallery';
  if(t==='monsters') return 'Monster List';
  return t;
}

function shortSummary(s){
  if(s.type==='header') return s.props.title || 'Header';
  if(s.type==='paragraph') return (s.props.text||'Paragraph').slice(0,60);
  if(s.type==='image') return s.props.url || 'Image';
  if(s.type==='gallery') return (s.props.images && s.props.images.length ? `${s.props.images.length} images` : 'Gallery (empty)');
  if(s.type==='monsters') return (s.props.items && s.props.items.length ? `${s.props.items.length} monsters` : 'Monster list (empty)');
  return '';
}

function moveSection(idx, dir){
  const to = idx + dir;
  if(to<0 || to>=sections.length) return;
  const [it] = sections.splice(idx,1);
  sections.splice(to,0,it);
  renderSectionsList();
  renderPreview();
}

/* EDITOR MODAL (simple inline area appended to section card) */
let currentEditorId = null;
function openEditor(id){
  currentEditorId = id;
  // find section card in DOM then inject editor
  const scards = [...sectionsContainer.children];
  for(const card of scards) card.style.outline = '';
  const idx = sections.findIndex(s=>s.id===id);
  if(idx<0) return;
  const card = scards[idx];
  card.style.outline = '2px solid rgba(179,0,0,0.3)';
  // remove any existing editor nodes
  const existingEditor = document.getElementById('sectionEditor');
  if(existingEditor) existingEditor.remove();

  const editor = document.createElement('div');
  editor.id = 'sectionEditor';
  editor.style.marginTop = '10px';
  editor.style.background = 'linear-gradient(180deg, rgba(0,0,0,0.25), rgba(0,0,0,0.12))';
  editor.style.padding = '10px';
  editor.style.borderRadius = '8px';
  editor.style.border = '1px solid rgba(255,255,255,0.03)';

  const s = sections[idx];
  // build form according to type
  if(s.type==='header'){
    editor.innerHTML = `
      <label>Title</label>
      <input id="edit_title" type="text" value="${escapeHtml(s.props.title||'')}" />
      <label>Subtitle</label>
      <input id="edit_sub" type="text" value="${escapeHtml(s.props.subtitle||'')}" />
      <label>Title Font</label>
      <select id="edit_font">
        <option value="Creepster, cursive">Creepster</option>
        <option value="Nosifer, cursive">Nosifer</option>
        <option value="MedievalSharp, cursive">MedievalSharp</option>
        <option value="Uncial Antiqua, serif">Uncial Antiqua</option>
        <option value="'Press Start 2P', monospace">Press Start 2P</option>
        <option value="Arial, sans-serif">System</option>
      </select>
      <label>Title Color</label>
      <input id="edit_titleColor" type="color" value="${s.props.titleColor||'#ffffff'}" />
      <label>Text Color</label>
      <input id="edit_textColor" type="color" value="${s.props.textColor||'#ffffff'}" />
      <label>Background Color</label>
      <input id="edit_bgColor" type="color" value="${s.props.bgColor && s.props.bgColor!=='transparent' ? s.props.bgColor : '#22030a'}" />
      <label>Background Image URL (optional)</label>
      <input id="edit_bgImage" type="url" value="${escapeHtml(s.props.bgImage||'')}" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveSection" class="btn">Save</button>
        <button id="cancelSection" class="btn ghost">Close</button>
      </div>
    `;
    editor.querySelector('#edit_font').value = s.props.titleFont || document.getElementById('defaultFont').value;
  } else if(s.type==='paragraph'){
    editor.innerHTML = `
      <label>Paragraph Text</label>
      <textarea id="edit_text">${escapeHtml(s.props.text||'')}</textarea>
      <label>Font</label>
      <select id="edit_font">
        <option value="Creepster, cursive">Creepster</option>
        <option value="Nosifer, cursive">Nosifer</option>
        <option value="MedievalSharp, cursive">MedievalSharp</option>
        <option value="Uncial Antiqua, serif">Uncial Antiqua</option>
        <option value="'Press Start 2P', monospace">Press Start 2P</option>
        <option value="Arial, sans-serif">System</option>
      </select>
      <label>Text Color</label>
      <input id="edit_textColor" type="color" value="${s.props.textColor||'#ffffff'}" />
      <label>Background Color</label>
      <input id="edit_bgColor" type="color" value="${s.props.bgColor && s.props.bgColor!=='transparent' ? s.props.bgColor : '#000000'}" />
      <label>Alignment</label>
      <select id="edit_align"><option value="left">Left</option><option value="center">Center</option><option value="justify">Justify</option></select>
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveSection" class="btn">Save</button><button id="cancelSection" class="btn ghost">Close</button>
      </div>
    `;
    editor.querySelector('#edit_font').value = s.props.font || document.getElementById('defaultFont').value;
    editor.querySelector('#edit_align').value = s.props.align || 'left';
  } else if(s.type==='image'){
    editor.innerHTML = `
      <label>Image URL</label>
      <input id="edit_url" type="url" value="${escapeHtml(s.props.url||'')}" />
      <label>Caption</label>
      <input id="edit_caption" type="text" value="${escapeHtml(s.props.caption||'')}" />
      <label>Image width (e.g. 100%, 600px)</label>
      <input id="edit_width" type="text" value="${escapeHtml(s.props.width||'100%')}" />
      <label>Background Color</label>
      <input id="edit_bgColor" type="color" value="${s.props.bgColor && s.props.bgColor!=='transparent' ? s.props.bgColor : '#000000'}" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveSection" class="btn">Save</button><button id="cancelSection" class="btn ghost">Close</button>
      </div>
    `;
  } else if(s.type==='gallery'){
    editor.innerHTML = `
      <label>Gallery Image URLs (one per line)</label>
      <textarea id="edit_images">${(s.props.images||[]).join('\\n')}</textarea>
      <label>Gallery Font</label>
      <select id="edit_font">
        <option value="Creepster, cursive">Creepster</option>
        <option value="Nosifer, cursive">Nosifer</option>
        <option value="MedievalSharp, cursive">MedievalSharp</option>
        <option value="Uncial Antiqua, serif">Uncial Antiqua</option>
        <option value="'Press Start 2P', monospace">Press Start 2P</option>
        <option value="Arial, sans-serif">System</option>
      </select>
      <label>Background Color</label>
      <input id="edit_bgColor" type="color" value="${s.props.bgColor && s.props.bgColor!=='transparent' ? s.props.bgColor : '#000000'}" />
      <label>Gap between images (px)</label>
      <input id="edit_gap" type="text" value="${s.props.gap || 8}" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveSection" class="btn">Save</button><button id="cancelSection" class="btn ghost">Close</button>
      </div>
    `;
    editor.querySelector('#edit_font').value = s.props.itemFont || document.getElementById('defaultFont').value;
  } else if(s.type==='monsters'){
    editor.innerHTML = `
      <label>Monsters — Add entries as "Name | ImageURL" one per line</label>
      <textarea id="edit_items">${(s.props.items||[]).map(it=> (it.name + ' | ' + (it.img||'')) ).join('\\n')}</textarea>
      <label>Card background color (semi-transparent ok)</label>
      <input id="edit_cardBg" type="text" value="${escapeHtml(s.props.cardBg||'rgba(255,255,255,0.02)')}" />
      <div style="display:flex;gap:8px;margin-top:8px">
        <button id="saveSection" class="btn">Save</button><button id="cancelSection" class="btn ghost">Close</button>
      </div>
    `;
  } else {
    editor.innerHTML = `<div>Unknown section</div>`;
  }

  card.appendChild(editor);

  // wire up save/cancel
  editor.querySelector('#cancelSection').addEventListener('click', ()=> {
    editor.remove();
    currentEditorId = null;
    for(const c of sectionsContainer.children) c.style.outline = '';
  });

  editor.querySelector('#saveSection').addEventListener('click', ()=>{
    // save fields into sections[idx].props
    if(s.type==='header'){
      s.props.title = editor.querySelector('#edit_title').value;
      s.props.subtitle = editor.querySelector('#edit_sub').value;
      s.props.titleFont = editor.querySelector('#edit_font').value;
      s.props.titleColor = editor.querySelector('#edit_titleColor').value;
      s.props.textColor = editor.querySelector('#edit_textColor').value;
      s.props.bgColor = editor.querySelector('#edit_bgColor').value;
      s.props.bgImage = editor.querySelector('#edit_bgImage').value;
    } else if(s.type==='paragraph'){
      s.props.text = editor.querySelector('#edit_text').value;
      s.props.font = editor.querySelector('#edit_font').value;
      s.props.textColor = editor.querySelector('#edit_textColor').value;
      s.props.bgColor = editor.querySelector('#edit_bgColor').value;
      s.props.align = editor.querySelector('#edit_align').value;
    } else if(s.type==='image'){
      s.props.url = editor.querySelector('#edit_url').value;
      s.props.caption = editor.querySelector('#edit_caption').value;
      s.props.width = editor.querySelector('#edit_width').value;
      s.props.bgColor = editor.querySelector('#edit_bgColor').value;
    } else if(s.type==='gallery'){
      s.props.images = editor.querySelector('#edit_images').value.split('\\n').map(x=>x.trim()).filter(x=>x);
      s.props.itemFont = editor.querySelector('#edit_font').value;
      s.props.bgColor = editor.querySelector('#edit_bgColor').value;
      s.props.gap = parseInt(editor.querySelector('#edit_gap').value) || 8;
    } else if(s.type==='monsters'){
      const raw = editor.querySelector('#edit_items').value.split('\\n').map(x=>x.trim()).filter(x=>x);
      s.props.items = raw.map(line=>{
        const parts = line.split('|').map(p=>p.trim());
        return { name: parts[0]||'Monster', img: parts[1]||'' };
      });
      s.props.cardBg = editor.querySelector('#edit_cardBg').value;
    }
    // re-render list & preview
    renderSectionsList();
    renderPreview();
    editor.remove();
    currentEditorId = null;
    for(const c of sectionsContainer.children) c.style.outline = '';
  });
}

/* Preview rendering */
function renderPreview(){
  // Build preview DOM in previewArea
  previewArea.innerHTML = '';
  const site = document.createElement('div');
  site.className = 'site';
  site.style.fontFamily = document.getElementById('defaultFont').value;

  // optional global bg
  const globalBg = document.getElementById('globalBg').value.trim();
  if(globalBg){
    site.style.backgroundImage = `url('${globalBg}')`;
    site.style.backgroundSize = 'cover';
    site.style.backgroundPosition = 'center';
  }

  // title strip
  const titleStrip = document.createElement('div');
  titleStrip.style.padding = '18px 24px';
  titleStrip.style.display = 'flex';
  titleStrip.style.justifyContent = 'space-between';
  titleStrip.style.alignItems = 'center';
  titleStrip.style.borderBottom = '1px solid rgba(255,255,255,0.03)';
  titleStrip.innerHTML = `<div style="font-size:20px; font-weight:700">${escapeHtml(document.getElementById('siteTitle').value || 'Haunt')}</div>
                          <div style="font-size:13px" class="muted-small">Spooky by Halloween Website Builder</div>`;
  site.appendChild(titleStrip);

  // build sections
  sections.forEach(s => {
    if(s.type==='header'){
      const el = document.createElement('div');
      el.className = 'page-header';
      el.style.background = s.props.bgColor || 'transparent';
      if(s.props.bgImage) el.style.backgroundImage = `url('${s.props.bgImage}')`, el.style.backgroundSize='cover', el.style.backgroundPosition='center';
      const t = document.createElement('h1');
      t.textContent = s.props.title || '';
      t.style.fontFamily = s.props.titleFont || document.getElementById('defaultFont').value;
      t.style.color = s.props.titleColor || '#fff';
      t.style.fontSize = '48px';
      t.style.margin = '0 0 10px 0';
      const sub = document.createElement('div');
      sub.textContent = s.props.subtitle || '';
      sub.style.color = s.props.textColor || '#fff';
      sub.style.fontSize = '18px';
      el.appendChild(t);
      el.appendChild(sub);
      site.appendChild(el);
    } else if(s.type==='paragraph'){
      const el = document.createElement('div');
      el.className = 'page-paragraph';
      el.style.background = s.props.bgColor || 'transparent';
      const p = document.createElement('p');
      p.textContent = s.props.text || '';
      p.style.fontFamily = s.props.font || document.getElementById('defaultFont').value;
      p.style.color = s.props.textColor || '#eee';
      p.style.textAlign = s.props.align || 'left';
      p.style.lineHeight = '1.6';
      p.style.fontSize = '16px';
      el.appendChild(p);
      site.appendChild(el);
    } else if(s.type==='image'){
      const wrap = document.createElement('div');
      wrap.style.padding = '12px';
      wrap.style.background = s.props.bgColor || 'transparent';
      const img = document.createElement('img');
      img.className = 'image-block';
      img.src = s.props.url || '';
      img.style.width = s.props.width || '100%';
      img.alt = s.props.caption || 'image';
      wrap.appendChild(img);
      if(s.props.caption){
        const cap = document.createElement('div');
        cap.textContent = s.props.caption;
        cap.style.textAlign = 'center';
        cap.style.marginTop = '6px';
        cap.style.color = '#ddd';
        wrap.appendChild(cap);
      }
      site.appendChild(wrap);
    } else if(s.type==='gallery'){
      const wrap = document.createElement('div');
      wrap.style.padding = '14px';
      wrap.style.background = s.props.bgColor || 'transparent';
      const grid = document.createElement('div');
      grid.className = 'gallery-grid';
      grid.style.gap = (s.props.gap||8) + 'px';
      (s.props.images||[]).forEach(url=>{
        const im = document.createElement('img');
        im.src = url;
        im.alt = 'gallery';
        grid.appendChild(im);
      });
      wrap.appendChild(grid);
      site.appendChild(wrap);
    } else if(s.type==='monsters'){
      const wrap = document.createElement('div');
      wrap.style.padding = '12px';
      const list = document.createElement('div');
      list.className = 'monster-list';
      (s.props.items||[]).forEach(it=>{
        const card = document.createElement('div');
        card.className = 'monster-card';
        card.style.background = s.props.cardBg || 'rgba(255,255,255,0.02)';
        if(it.img){
          const im = document.createElement('img');
          im.src = it.img;
          card.appendChild(im);
        }
        const nm = document.createElement('div');
        nm.textContent = it.name || 'Monster';
        nm.style.fontWeight = '700';
        card.appendChild(nm);
        list.appendChild(card);
      });
      wrap.appendChild(list);
      site.appendChild(wrap);
    }
  });

  // footer
  const footer = document.createElement('footer');
  footer.className = 'builder-footer';
  footer.innerHTML = `<div>
      <div style="font-weight:700">${escapeHtml(document.getElementById('contactTitle').value || '')}</div>
      <div style="font-size:13px">${escapeHtml(document.getElementById('contactEmail').value || '')} • ${escapeHtml(document.getElementById('contactPhone').value || '')}</div>
    </div>
    <div style="text-align:right;font-size:13px">${escapeHtml(document.getElementById('contactAddr').value || '')}</div>`;
  site.appendChild(footer);

  previewArea.appendChild(site);
}

/* Build full exported HTML string */
function buildExportHtml(previewMode=false){
  const title = sanitizeForHtml(document.getElementById('siteTitle').value || 'Haunted Site');
  const globalBg = document.getElementById('globalBg').value.trim();
  const accent = document.getElementById('globalAccent').value || '#b30000';
  const fontLink = `<link href="https://fonts.googleapis.com/css2?family=Creepster&family=Nosifer&family=MedievalSharp&family=Uncial+Antiqua&family=Press+Start+2P&display=swap" rel="stylesheet">`;

  // build body HTML for sections
  const bodyParts = [];
  bodyParts.push(`<div class="site" ${globalBg ? `style="background-image:url('${escapeAttr(globalBg)}');background-size:cover;background-position:center;"` : ''}>`);
  bodyParts.push(`<div class="header-strip"><div class="site-title">${escapeHtml(title)}</div><div class="site-tag">Spooky by Halloween Builder</div></div>`);

  sections.forEach(s=>{
    if(s.type==='header'){
      const bgStyle = s.props.bgImage ? `background-image:url('${escapeAttr(s.props.bgImage)}'); background-size:cover; background-position:center;` : `background:${s.props.bgColor || 'transparent'};`;
      bodyParts.push(`<section class="page-header" style="${bgStyle}">`);
      bodyParts.push(`<h1 style="font-family:${s.props.titleFont||'Creepster, cursive'};color:${s.props.titleColor||'#fff'}">${escapeHtml(s.props.title||'')}</h1>`);
      bodyParts.push(`<p style="color:${s.props.textColor||'#fff'}">${escapeHtml(s.props.subtitle||'')}</p>`);
      bodyParts.push(`</section>`);
    } else if(s.type==='paragraph'){
      bodyParts.push(`<section class="page-paragraph" style="background:${s.props.bgColor || 'transparent'}">`);
      bodyParts.push(`<p style="font-family:${s.props.font||'Uncial Antiqua, serif'};color:${s.props.textColor || '#fff'};text-align:${s.props.align||'left'}">${escapeHtml(s.props.text||'')}</p>`);
      bodyParts.push(`</section>`);
    } else if(s.type==='image'){
      bodyParts.push(`<section style="background:${s.props.bgColor || 'transparent'};padding:12px;text-align:center">`);
      bodyParts.push(`<img src="${escapeAttr(s.props.url||'')}" alt="${escapeAttr(s.props.caption||'')}" style="max-width:100%;width:${escapeAttr(s.props.width||'100%')};border-radius:8px" />`);
      if(s.props.caption) bodyParts.push(`<div style="margin-top:8px;color:#ddd">${escapeHtml(s.props.caption)}</div>`);
      bodyParts.push(`</section>`);
    } else if(s.type==='gallery'){
      bodyParts.push(`<section class="gallery" style="background:${s.props.bgColor || 'transparent'};padding:14px">`);
      bodyParts.push(`<div class="gallery-grid" style="display:flex;flex-wrap:wrap;gap:${(s.props.gap||8)}px;justify-content:center">`);
      (s.props.images||[]).forEach(url=>{
        bodyParts.push(`<img src="${escapeAttr(url)}" style="width:calc(33% - ${(s.props.gap||8)}px);min-width:160px;border-radius:8px;margin-bottom:8px" />`);
      });
      bodyParts.push(`</div></section>`);
    } else if(s.type==='monsters'){
      bodyParts.push(`<section class="monsters" style="padding:12px">`);
      bodyParts.push(`<div class="monster-list" style="display:flex;flex-wrap:wrap;gap:12px;justify-content:center">`);
      (s.props.items||[]).forEach(it=>{
        bodyParts.push(`<div class="monster-card" style="width:200px;border-radius:10px;padding:12px;background:${s.props.cardBg || 'rgba(255,255,255,0.02)'};text-align:center">`);
        if(it.img) bodyParts.push(`<img src="${escapeAttr(it.img)}" style="width:100%;border-radius:8px;margin-bottom:8px" />`);
        bodyParts.push(`<div style="font-weight:700">${escapeHtml(it.name||'Monster')}</div>`);
        bodyParts.push(`</div>`);
      });
      bodyParts.push(`</div></section>`);
    }
  });

  // footer
  bodyParts.push(`<footer class="site-footer" style="padding:18px;background:linear-gradient(180deg, rgba(0,0,0,0.3), rgba(0,0,0,0.6));display:flex;justify-content:space-between;align-items:center">`);
  bodyParts.push(`<div><strong>${escapeHtml(document.getElementById('contactTitle').value||'Contact')}</strong><div style="font-size:13px">${escapeHtml(document.getElementById('contactEmail').value||'')}</div></div>`);
  bodyParts.push(`<div style="text-align:right">${escapeHtml(document.getElementById('contactPhone').value||'')}<div style="font-size:13px">${escapeHtml(document.getElementById('contactAddr').value||'')}</div></div>`);
  bodyParts.push(`</footer>`);
  bodyParts.push(`</div>`); // site

  const css = `
    body{margin:0;font-family:Inter,system-ui,Arial;background:#050005;color:#fff}
    .site{max-width:1100px;margin:0 auto;border-radius:8px;overflow:hidden;background:linear-gradient(180deg,#0a0410,#15061a);box-shadow:0 10px 40px rgba(0,0,0,0.7);padding:0}
    .header-strip{padding:18px 24px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid rgba(255,255,255,0.03)}
    .site-title{font-size:20px;font-weight:800}
    .page-header{padding:40px 24px;text-align:center}
    .page-header h1{font-size:48px;margin:0}
    .page-paragraph{padding:18px 24px;max-width:900px;margin:0 auto}
    .gallery-grid img{border-radius:8px}
    .monster-card img{border-radius:8px}
    .site-footer{color:#ddd}
    @media(max-width:800px){ .gallery-grid img{width:100% !important;min-width:unset} .page-header h1{font-size:28px} }
  `;

  const final = `<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>${title}</title>
${fontLink}
<style>${css}</style>
</head><body>
${bodyParts.join('\n')}
</body></html>`;

  return final;
}

/* util: download file */
function downloadFile(content, filename, type){
  const a = document.createElement('a');
  const blob = new Blob([content], {type: type || 'text/plain'});
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  setTimeout(()=> URL.revokeObjectURL(a.href), 1000);
}

/* small helpers */
function escapeHtml(s){ if(!s) return ''; return (s+'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function escapeAttr(s){ if(!s) return ''; return (s+'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#39;'); }
function sanitizeForHtml(s){ return escapeHtml(s || ''); }

/* init */
resetDemo();
renderSectionsList();
renderPreview();

/* watch inputs to update preview live */
['siteTitle','globalBg','defaultFont','contactTitle','contactEmail','contactPhone','contactAddr','globalAccent'].forEach(id=>{
  document.getElementById(id).addEventListener('input', renderPreview);
});

</script>
</body>
</html>
